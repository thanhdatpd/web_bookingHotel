
<%- include("./layouts/header") %>
<!-- Breadcrumb Section Begin -->
<div class="breadcrumb-section">
  <div class="container">
    <div class="row">
      <div class="col-lg-12">
        <div class="breadcrumb-text">
          <h2>Xác nhận và thanh toán  </h2>
          <div class="bt-option">
            <a href="/">Trang chủ</a>
            <span>Thông tin đặt phòng</span>
          </div>
        </div>
      </div>
    </div>
    <div class="row pt-3 mt-2 " style="border: 2px solid rgb(236, 175, 5)">
      <div class="col-lg-12">
        <div class="d-sm-flex align-items-center justify-content-center mb-4">
          <h1 class=" h5 mb-0 text-gray-800 text-warning  ">*Thông tin của bạn</h1>
        </div>
        <div class="panel panel-default">
          <div class="panel-body">
            <form id="">
              <div class="row">
                <div class="form-group col-sm-6 ">
                  <label>Email</label>
                  <input id="email" name="email" type="text" class="form-control" value="<%=user.email%>">
                </div>
                <div class="form-group col-sm-6">
                  <label>Họ & Tên</label>
                  <input id="fullName" name="fullName" required class="form-control" placeholder="" value="<%=user.fullName%>">
                </div>
              </div>
              <div class="row">
                <div class="form-group col-sm-6">
                  <label>Số điện thoại</label>
                  <input id="phoneNumber" name="phoneNumber" type="number" class="form-control" placeholder="" value="<%=user.phoneNumber%>">
                </div>
                <div class="form-group col-sm-6">
                  <label>Mã giảm giá</label>
                  <input id="free" value="H2020PN" name="free" class="form-control" placeholder="">
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
      


      <div class="col-lg-12">
        <div class="d-sm-flex align-items-center justify-content-center mb-4">
          <h1 class=" h5 mb-0 text-gray-800 text-warning  ">*Chính sách nội quy</h1>
        </div>
        <div class="d-flex flex-column justify-content-center ">
          <span class="pl-2 pb-3">+ Yêu cầu chứng minh thư, căn cước công dân hoặc đặt cọc tại chỗ
            nghỉ , hạn chế làm ồn sau 10 giờ tối.Không đi giày dép trong nhà,không hút thuốc ở khu vực chung</span>
        </div>
        
        <div class="d-sm-flex align-items-center justify-content-center mb-4">
          <h1 class=" h5 mb-0 text-gray-800 text-warning  ">*Trách nhiệm vật chất</h1>
        </div>
        <div class="d-flex flex-column justify-content-center ">
          <span class="pl-2 pb-3">+ Khách hàng chịu mọi trách nhiệm thiệt hại về tài sản đã gây ra tại chỗ ở trong thời gian lưu trú. Không mang chất cháy nổ, chất kích thích, gây nguy hiểm cho khách sạn <span>
        </div>
        <div class="d-sm-flex align-items-center justify-content-center mb-4">
          <h1 class=" h5 mb-0 text-gray-800 text-warning  ">*Chính sách huỷ phòng</h1>
        </div>
        <div class="d-flex flex-column justify-content-center ">
          <span class="pl-2 pb-3">+ Nghiêm ngặt : Hoàn lại 50% giá trị đặt phòng khi khách hàng huỷ phòng trong vòng 48h sau khi đặt phòng thành công và
          trước 14 ngày so với thời gian check-in. Sau đó, hủy phòng trước 14 ngày so với thời gian check-in, được hoàn lại 50%
          tổng số tiền đã trả (trừ phí dịch vụ).<span>
        </div>
        <div class="d-sm-flex align-items-center justify-content-center mb-4">
          <h1 class=" h5 mb-0 text-gray-800 text-warning  ">*Thông tin đặt phòng</h1>
        </div>
        <div class="panel panel-default">
          <div class="panel-body">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th scope="col">#</th>
                  <th scope="col">Ngày bắt đầu</th>
                  <th scope="col">Ngày kết thúc</th>
                  <th scope="col">Tên phòng</th>
                  <th scope="col">Số người</th>
                  <th scope="col">Giá tiền</th>
                  <th scope="col">Hủy chọn</th>
                </tr>
              </thead>
              <tbody>
                <% bookingArr.forEach((booking, index) => { %>
                <tr>
                  <input type="hidden" id="roomId" value="<%=booking.roomId%>">
                  <th scope="row"><%=index+1%></th>
                  <td><%=booking.startAt%></td>
                  <td><%=booking.endAt%></td>
                  <td><span class="badge badge-info"><%=booking.roomName%></span></td>
                  <% if (booking.numberCustomer === "two") { %>
                  <td><span class="badge badge-warning">1-2 người</span></td>
                  <% }                                              
                    else { %>
                  <td><span class="badge badge-warning">3 người trở lên</span></td>
                  <% } %>
                  <td><span class="badge badge-primary"><%=booking.price%> VNĐ</span></td>
                  <td>
                    <a onclick="removeBooking()"
                    class="btn btn-danger btn-circle"><i class="fas fa-trash "></i></a>
                  </td>
                </tr> 
                <% }) %>
                
              </tbody>
            </table>
              
            
          </div>
        </div>
        <div class="d-flex  justify-content-center ">
        
          <span class="h5 pl-2 pb-3 mt-4 mb-4 text-primary ">+ Tổng tiền : 

            <span class="badge badge-primary"><%=total %> VNĐ</span>

            <span>         
        </div>
        <div class="d-flex justify-content-center mb-3">
          <button onclick="confirmAndPay()" type="button" class="btn btn-success">Đặt phòng</button>
          <button type="reset" class="btn btn-default">Huỷ</button>
        </div>
      </div>
      
      
    </div>
  </div>
  </div>
</div>

  <script>
    /*get Cookie */
    function getCookie(cname) {
        var name = cname + "=";
        var decodedCookie = decodeURIComponent(document.cookie);
        var ca = decodedCookie.split(';');
        for (var i = 0; i < ca.length; i++) {
          var c = ca[i];
          while (c.charAt(0) == ' ') {
            c = c.substring(1);
          }
          if (c.indexOf(name) == 0) {
            return c.substring(name.length, c.length);
          }
        }
        return "";
      }
    /*set Cookie */
    function setCookie(cname, cvalue, exdays) {
        var d = new Date();
        d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
        var expires = "expires=" + d.toUTCString();
        document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
      }
      /*delete Cookie */
      function deleteCookie(name) {
          document.cookie = name + '=; expires=Thu, 01 Jan 1970 00:00:01 GMT;';
        }
    function removeBooking(){
      var roomId = $("#roomId").val();
      $.ajax({
        url: "/booking-delete",
        method: "post",
        data: {
          roomId: roomId,
        }
      }).then(function (data) {
        alertify.confirm(data.message,
          function () {
             location.reload();
            setCookie("bookings", JSON.stringify(data.newBooking), 1)
          },
          function () {
            window.timeout = setTimeout(function () {
              window.location.href = "/checks/confirmAndPay";
            })
          })  
      }).catch(function (err) {
        alertify.error(err.responseJSON.message);
      })
    }
  
    function confirmAndPay() {
         let bookings = $.parseJSON(getCookie("bookings"));
      $.ajax({
        url: "/checks/confirmAndPay",
        method: "POST",
        data: {
          bookings: bookings,
        }
      }).then(function (data) {
        deleteCookie("bookings")
        alertify.success(data.message);
        window.timeout = setTimeout(function () {
          window.location.href = "/my-bookings";
        },2000)
      }).catch(function (err) {
        alertify.error(err.responseJSON.message);
      })
    }
  
  </script>

    <%- include("./layouts/footer") %>
